### ğŸ“‚ é¡¹ç›®ç»“æ„ (Project Structure)

```
NIR_Eye_Refraction_Project/
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ preprocess_config.yaml    # æ ¸å¿ƒé…ç½®æ–‡ä»¶ (è·¯å¾„ã€é˜ˆå€¼ã€ROIå‚æ•°)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ io/
â”‚   â”‚   â””â”€â”€ parser.py             # æ–‡ä»¶åæ ‡ç­¾è§£æ & è½´ä½ç¼–ç 
â”‚   â”œâ”€â”€ qc/
â”‚   â”‚   â””â”€â”€ validator.py          # å›¾åƒè´¨é‡æ£€æŸ¥ (åŸºäºçº¯OpenCVå…‰æ–‘æ£€æµ‹)
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ clean_dataset.py      # [ç¬¬ä¸€æ­¥] æ•°æ®æ¸…æ´—å…¥å£
â”‚       â””â”€â”€ process_roi.py        # [ç¬¬äºŒæ­¥] ROI æå–ä¸åˆ†å‰²å…¥å£
â”œâ”€â”€ data/                         # æ•°æ®å­˜æ”¾ç›®å½• (raw / processed / metadata)
â”œâ”€â”€ logs/                         # å¤„ç†æ—¥å¿—
â””â”€â”€ README.md


```



### ç¬¬ä¸€æ­¥ï¼šæ•°æ®æ¸…æ´—ä¸æ ‡ç­¾è§£æ (Data Cleaning)

éå†åŸå§‹æ•°æ®æ–‡ä»¶å¤¹ï¼Œè§£ææ–‡ä»¶åä¸­çš„å±ˆå…‰åº¦æ ‡ç­¾ï¼Œå¹¶è¿›è¡Œå›¾åƒè´¨é‡æ£€æŸ¥ï¼ˆæ›å…‰ã€æ¨¡ç³Šã€çº¢å¤–å…‰æ–‘æ£€æµ‹ï¼‰ã€‚

`python src/scripts/clean_dataset.py`

**åŠŸèƒ½ï¼š**

- **è½´ä½ç¼–ç **ï¼šå°† 0âˆ˜âˆ¼180âˆ˜ çš„æ•£å…‰è½´ä½æ˜ å°„ä¸º sin(2A) å’Œ cos(2A)ï¼Œè§£å†³è§’åº¦å›å½’çš„ä¸è¿ç»­æ€§é—®é¢˜ã€‚
- **è´¨é‡æ§åˆ¶**ï¼šè‡ªåŠ¨å‰”é™¤ä¸¥é‡è¿‡æ›ã€æ¬ æ›æˆ–æœªæ£€æµ‹åˆ°çº¢å¤–åå°„å…‰æ–‘çš„æ— æ•ˆæ ·æœ¬ã€‚

**è¾“å‡ºäº§ç‰©ï¼š**

- `data/metadata/cleaned_dataset.csv`: åˆæ­¥æ¸…æ´—åçš„æœ‰æ•ˆæ ·æœ¬æ¸…å•ã€‚
- `logs/rejected_samples.txt`: è¢«å‰”é™¤æ ·æœ¬çš„è¯¦ç»†åˆ—è¡¨åŠåŸå› ã€‚



### ç¬¬äºŒæ­¥ï¼šROI æå–ä¸åŒçœ¼åˆ†å‰² (ROI Extraction & Splitting)

è¯»å–ç¬¬ä¸€æ­¥ç”Ÿæˆçš„ CSVï¼Œå®šä½ç³å­”ä¸­å¿ƒï¼Œè£å‰ªå‡ºæ ‡å‡†åŒ–çš„çœ¼éƒ¨å›¾åƒï¼Œå¹¶å°†**å·¦å³çœ¼æ‹†åˆ†ä¸ºç‹¬ç«‹æ ·æœ¬**ã€‚

`python src/scripts/process_roi.py`



**åŠŸèƒ½ï¼š**

1. **åŒçœ¼æ‹†åˆ† (Split L/R)**ï¼š
   - è‡ªåŠ¨å°†å•å¼ åŒ…å«åŒçœ¼çš„å›¾ç‰‡å‚ç›´åˆ‡å‰²ã€‚
   - **å·¦åŠå›¾** -> æ ‡è®°ä¸ºå³çœ¼ (R)ï¼›**å³åŠå›¾** -> æ ‡è®°ä¸ºå·¦çœ¼ (L)ã€‚
2. **æŠ—å¹²æ‰°å®šä½ (Robust Localization)**ï¼š
   - åœ¨å®šä½ç³å­”å…‰æ–‘æ—¶ï¼Œè‡ªåŠ¨å¿½ç•¥å›¾åƒ**é¡¶éƒ¨ 15%** (å¤´å¸¦åŒºåŸŸ) å’Œ **åº•éƒ¨ 15%** (è®¾å¤‡åå…‰åŒºåŸŸ)ï¼Œé˜²æ­¢å®šä½æ¼‚ç§»ã€‚
3. **å®šé•¿è£å‰ª (Fixed-size Crop)**ï¼š
   - ä»¥ç³å­”ä¸ºä¸­å¿ƒè£å‰ª **224x224** åŒºåŸŸï¼Œä¿æŒåŸå§‹åˆ†è¾¨ç‡ä¸ç¼©æ”¾ï¼ˆå¾®è·è§†é‡ï¼‰ã€‚
4. **é»‘è‰²å¡«å…… (Zero Padding)**ï¼š
   - è¾¹ç¼˜åŒºåŸŸä½¿ç”¨ **0 (é»‘è‰²)** å¡«å……ã€‚

**è¾“å‡ºäº§ç‰©ï¼š**

- `data/processed/`: å­˜æ”¾å¤„ç†åçš„ PNG å›¾åƒï¼ˆæŒ‰ `uuid_side` åˆ†æ–‡ä»¶å¤¹ï¼‰ã€‚
- `data/metadata/processed_dataset_split.csv`: **æœ€ç»ˆç”¨äºè®­ç»ƒçš„æ•°æ®è¡¨**ã€‚



## âš™ï¸ å‚æ•°é…ç½® (Configuration)

æ‰€æœ‰å…³é”®å‚æ•°å‡å¯åœ¨ `configs/preprocess_config.yaml` ä¸­åŠ¨æ€è°ƒæ•´ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚

##### 

#### è·¯å¾„é…ç½® (Paths)

```
paths:
  raw_dataset_dir: "data/raw"              # åŸå§‹æ•°æ®ä½ç½®
  output_dir: "data/processed"             # è¾“å‡ºå›¾ç‰‡ä½ç½®
  output_csv: "data/metadata/cleaned_dataset.csv"
```

#### ROI å‚æ•° (ROI Params)

```


roi_params:
  target_size: 224           # æ¨¡å‹è¾“å…¥å°ºå¯¸ (224x224)
  padding_mode: "constant"   # å¡«å……æ¨¡å¼
  padding_value: 0           # å¡«å……é¢œè‰² (0=é»‘è‰²)

# æŠ—å¹²æ‰°åŒºåŸŸé™åˆ¶

  vertical_margin_top: 0.15     # å¿½ç•¥é¡¶éƒ¨ 15%
  vertical_margin_bottom: 0.20  # å¿½ç•¥åº•éƒ¨ 20%
```

#### è´¨é‡æ§åˆ¶ (QC Params)

```
qc_params:
  reflection_threshold: 170.0   # çº¢å¤–å…‰æ–‘äº®åº¦é˜ˆå€¼ (ä½äºæ­¤å€¼è§†ä¸ºæ— æ•ˆ/é—­çœ¼)
  blur_threshold: 20.0          # æ¸…æ™°åº¦é˜ˆå€¼
```



## ğŸ“Š æ•°æ®é›†æ ¼å¼è¯´æ˜ (Output Format)

æœ€ç»ˆç”Ÿæˆçš„ `processed_dataset_split.csv` æ ¼å¼å¦‚ä¸‹ï¼Œå¯ç›´æ¥ç”¨äº PyTorch `DataLoader`ï¼š

| **å­—æ®µ (Column)** | **ç¤ºä¾‹ (Example)**            | **è¯´æ˜**                  |
| ----------------- | ----------------------------- | ------------------------- |
| sample_id         | uuid123_L                     | å”¯ä¸€ID (åç¼€åŒºåˆ†å·¦å³çœ¼)   |
| side              | L                             | çœ¼ç›æ ‡è¯† (L=å·¦çœ¼, R=å³çœ¼) |
| S                 | -2.50                         | çƒé•œåº¦æ•° (Label)          |
| C                 | -0.50                         | æŸ±é•œåº¦æ•° (Label)          |
| sin_2A            | 0.034                         | è½´ä½ç¼–ç  Sine åˆ†é‡        |
| cos_2A            | 0.999                         | è½´ä½ç¼–ç  Cosine åˆ†é‡      |
| path_0            | `data/processed/.../es_0.png` | ç¬¬1å¼ å›¾ç‰‡çš„ç›¸å¯¹è·¯å¾„       |
| path_5            | data/processed/.../es_5.png   | ç¬¬6å¼ å›¾ç‰‡çš„ç›¸å¯¹è·¯å¾„       |
|                   |                               |                           |

